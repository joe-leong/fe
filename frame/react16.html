<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React16 | 前端小梁</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/fe/img/logo.png">
    <meta name="description" content="前端工程">
    <meta name="keywords" content="前端空间">
    
    <link rel="preload" href="/fe/assets/css/0.styles.2519444e.css" as="style"><link rel="preload" href="/fe/assets/js/app.3d2a803f.js" as="script"><link rel="preload" href="/fe/assets/js/2.17d60f83.js" as="script"><link rel="preload" href="/fe/assets/js/1.6a888610.js" as="script"><link rel="preload" href="/fe/assets/js/34.403d13b1.js" as="script"><link rel="prefetch" href="/fe/assets/js/10.a9d975be.js"><link rel="prefetch" href="/fe/assets/js/11.1b1030c8.js"><link rel="prefetch" href="/fe/assets/js/12.c1aff2a0.js"><link rel="prefetch" href="/fe/assets/js/13.08aa9917.js"><link rel="prefetch" href="/fe/assets/js/14.59076001.js"><link rel="prefetch" href="/fe/assets/js/15.a6074940.js"><link rel="prefetch" href="/fe/assets/js/16.d3f28060.js"><link rel="prefetch" href="/fe/assets/js/17.ef2a2a56.js"><link rel="prefetch" href="/fe/assets/js/18.6de233c4.js"><link rel="prefetch" href="/fe/assets/js/19.d6922f6a.js"><link rel="prefetch" href="/fe/assets/js/20.747060c8.js"><link rel="prefetch" href="/fe/assets/js/21.46e578f2.js"><link rel="prefetch" href="/fe/assets/js/22.deb2fa6d.js"><link rel="prefetch" href="/fe/assets/js/23.66f4a9a2.js"><link rel="prefetch" href="/fe/assets/js/24.6089cbf1.js"><link rel="prefetch" href="/fe/assets/js/25.eeef68b1.js"><link rel="prefetch" href="/fe/assets/js/26.23fd1e90.js"><link rel="prefetch" href="/fe/assets/js/27.f581a276.js"><link rel="prefetch" href="/fe/assets/js/28.01e2396f.js"><link rel="prefetch" href="/fe/assets/js/29.f2b46779.js"><link rel="prefetch" href="/fe/assets/js/3.4bfb056a.js"><link rel="prefetch" href="/fe/assets/js/30.5985e0a6.js"><link rel="prefetch" href="/fe/assets/js/31.4578376e.js"><link rel="prefetch" href="/fe/assets/js/32.c38aa927.js"><link rel="prefetch" href="/fe/assets/js/33.36a5a10f.js"><link rel="prefetch" href="/fe/assets/js/35.b1c10c59.js"><link rel="prefetch" href="/fe/assets/js/36.e472a2ff.js"><link rel="prefetch" href="/fe/assets/js/37.5ce5a573.js"><link rel="prefetch" href="/fe/assets/js/4.daf19725.js"><link rel="prefetch" href="/fe/assets/js/5.eff0709b.js"><link rel="prefetch" href="/fe/assets/js/6.ec81d580.js"><link rel="prefetch" href="/fe/assets/js/7.86371d52.js"><link rel="prefetch" href="/fe/assets/js/vendors~docsearch.03d43e08.js">
    <link rel="stylesheet" href="/fe/assets/css/0.styles.2519444e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe/" class="home-link router-link-active"><img src="/fe/img/logo.png" alt="前端小梁" class="logo"> <span class="site-name can-hide">前端小梁</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe/index.html" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/coding/javascript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/HTTP.html" class="nav-link">
  http
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/datastructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/algorithm.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/node.html" class="nav-link">
  Node
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/frame/react.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/react15.html" class="nav-link">
  React15
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/react16.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  React16
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/vue3.x.html" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/vue2.x.html" class="nav-link">
  Vue2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/engineering/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/fe/engineering/vite.html" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="npm" class="dropdown-title"><span class="title">npm</span> <span class="arrow down"></span></button> <button type="button" aria-label="npm" class="mobile-dropdown-title"><span class="title">npm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/eslint-config-q-eslint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/q-markdownlint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  markdownlint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/commitlint-config-q-commitlint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  commitlint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/q-stylelint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  stylelint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.npmjs.com/package/q-lint" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://joe-leong.github.io/q-hooks" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/joe-leong/fe" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe/index.html" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/coding/javascript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/HTTP.html" class="nav-link">
  http
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/datastructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/algorithm.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/fe/coding/node.html" class="nav-link">
  Node
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/frame/react.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/react15.html" class="nav-link">
  React15
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/react16.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  React16
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/vue3.x.html" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/fe/frame/vue2.x.html" class="nav-link">
  Vue2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/engineering/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/fe/engineering/vite.html" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="npm" class="dropdown-title"><span class="title">npm</span> <span class="arrow down"></span></button> <button type="button" aria-label="npm" class="mobile-dropdown-title"><span class="title">npm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/eslint-config-q-eslint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  eslint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/q-markdownlint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  markdownlint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/commitlint-config-q-commitlint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  commitlint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/q-stylelint-config" target="_blank" rel="noopener noreferrer" class="nav-link external">
  stylelint-config
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.npmjs.com/package/q-lint" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://joe-leong.github.io/q-hooks" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/joe-leong/fe" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React16</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe/frame/react16.html#架构" class="sidebar-link">架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#scheduler-调度器" class="sidebar-link">Scheduler（调度器）</a></li><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#reconciler-协调器" class="sidebar-link">Reconciler（协调器）</a></li><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#renderer-渲染器" class="sidebar-link">Renderer（渲染器）</a></li></ul></li><li><a href="/fe/frame/react16.html#生命周期-16-4" class="sidebar-link">生命周期（16.4+）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#创建阶段" class="sidebar-link">创建阶段</a></li><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#更新阶段" class="sidebar-link">更新阶段</a></li><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#卸载阶段" class="sidebar-link">卸载阶段</a></li><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#与16-4-对比" class="sidebar-link">与16.4-对比</a></li></ul></li><li><a href="/fe/frame/react16.html#v18新特性" class="sidebar-link">v18新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe/frame/react16.html#新增hook" class="sidebar-link">新增hook</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react16"><a href="#react16" class="header-anchor">#</a> React16</h1> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <p>React16架构分为三层：</p> <ul><li>Scheduler（调度器）- 调度任务的优先级，高优先级优先进入<code>Reconciler</code></li> <li>Reconciler（协调器）- 负责找出变化的组件</li> <li>Renderer（渲染器）- 负责将变化的组件渲染到页面上</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>相比较于15，增加了Scheduler调度任务</p></div> <h3 id="scheduler-调度器"><a href="#scheduler-调度器" class="header-anchor">#</a> Scheduler（调度器）</h3> <p>如果需要实现异步，那么就需要知道浏览器是否有剩余时间，在浏览器中有原生的API<code>requestIdleCallback</code>，但是该api存在以下问题</p> <ul><li>兼容性</li> <li>触发频率不稳定，影响因素很多。比如当前tab切换后，之前tab注册的时间触发的频率会变得很低。</li></ul> <p>所以React实现了<code>requestIdleCallback</code>pollyfill。除了在空闲时触发回调的功能外，还提供了多种调度优先级供任务设置。</p> <h3 id="reconciler-协调器"><a href="#reconciler-协调器" class="header-anchor">#</a> Reconciler（协调器）</h3> <p>16+版本中，<code>Reconciler</code> 更新工作从递归变成了可中断的循环过程。每次循环都会调用<code>shouldYield</code>获取当前是否有剩余时间。并且<code>Reconciler</code>和<code>Renderer</code>不再是交替工作。当<code>Schuduler</code>把任务交给<code>Reconciler</code>之后，<code>Reconciler</code>会为变化的虚拟DOM打上标记（增/删/更新）</p> <p>整个过程都在内存中进行。只有当所有组件都完成<code>Reconciler</code>的工作，再会统一交给<code>Renderer</code>进行渲染工作</p> <p><code>Reconciler</code> 和 <code>Schuduler</code> 被称为 <code>render</code> 阶段，具体流程如下：</p> <ul><li><p><code>beginwork</code> 递</p> <ul><li>从 <code>rootFiber</code> 开始 <code>child</code>，如果遇到函数组件或者类组件则调用渲染函数生成新的 <code>child</code>(Fiber Array)</li> <li><code>reconcilerChildren</code>，对已存在的child与生成的child进行diff，如果是单节点，直接进入更新单节点，如果是数组，则会进入diff逻辑，尽可能复用已有Fiber，创建的effectTag包含更新、删除并且更新 <code>父Fiber</code> 的tag，如果是新建的话就不需要打tag
<code>diff算法</code>:
<ul><li><code>oldChild</code> 与新渲染产生的child循序遍历，比较tag与key，如果相同则复用，判断props是否需要更新，需要更新则标记 <code>update</code> 并更新父节点 <code>effectTag</code>，更新<code>lastPlaceIndex</code></li> <li>一旦遇到不能复用，则把<code>oldChild</code>创建map，遍历新节点，在map中查找可复用节点,如果没找到则新建 <code>Fiber</code></li> <li>遍历map，打上 <code>delete</code> 标记</li></ul></li></ul></li> <li><p><code>completework</code> 归</p> <ul><li>处理flag：把 <code>Fiber</code> 自身的 <code>flag</code> 以及 <code>subtreeFlag</code> 冒泡到 <code>父Fiber</code></li> <li>处理 <code>Fiber</code> 的 <code>stateNode</code>，如果没有则需要创建，并且把子孙节点append到当前DOM节点下，存在的话就更新props、事件绑定等</li> <li>把每个 <code>Fiber</code> 的 <code>Effect</code> 添加到 <code>父Fiber</code> 上组成 <code>effectList</code>，在commit阶段会遍历单向链执行对应操作</li></ul></li></ul> <h3 id="renderer-渲染器"><a href="#renderer-渲染器" class="header-anchor">#</a> Renderer（渲染器）</h3> <p><code>Renderer</code>根据<code>Reconciler</code>的标记，同步执行对应的DOM操作
此阶段也称为<code>commit 阶段</code>，分为三个步骤：</p> <h4 id="before-mutation"><a href="#before-mutation" class="header-anchor">#</a> before mutation</h4> <p>遍历 <code>effectList</code> 处理 <code>DOM</code> 节点 <code>渲染/删除</code> 后的 <code>聚焦/失焦</code> 逻辑，调用 <code>getSnapShotBeforeUpdate</code> 生命周期钩子，调度 <code>useEffect</code> （使用SchedulerCallback调度）</p> <h4 id="mutation"><a href="#mutation" class="header-anchor">#</a> mutation</h4> <ul><li>更新文本节点的content</li> <li>更新ref</li> <li>根据 <code>effectTag</code> 进行对应处理，包含操作：移动、插入、更新、删除等组合</li> <li>更新 <code>DOM</code> props、properties（遍历pendingProps，数据在completeWork阶段完成处理）</li> <li>如果是 <code>FC</code> 则需要调用 <code>useLayout</code> 的销毁函数</li> <li>完成后再进入 <code>layout</code> 阶段前需要把current指针切换，因为 <code>mutation</code> 阶段会调用 <code>componentWillUnmount</code>，此时的 <code>DOM</code> 还是更新前的</li></ul> <h4 id="layout"><a href="#layout" class="header-anchor">#</a> layout</h4> <p>到达这个阶段，已经完成 <code>离屏DOM</code> 的布局，只是浏览器尚未完成渲染</p> <ul><li>遍历 <code>effectList</code> 执行 <code>commitLayoutEffcts</code> 函数：赋值 <code>ref</code>、调用生命周期钩子和hooks</li> <li>执行 <code>useLayout</code> 回调函数，调度 <code>useEffect</code> 的销毁函数以及回调函数</li> <li>类组件 <code>this.setState</code> 的第二个回调函数也会执行</li> <li>执行的生命周期钩子：<code>componentDidMount</code>, <code>componentDidUpdate</code></li></ul> <h2 id="生命周期-16-4"><a href="#生命周期-16-4" class="header-anchor">#</a> 生命周期（16.4+）</h2> <h3 id="创建阶段"><a href="#创建阶段" class="header-anchor">#</a> 创建阶段</h3> <ul><li>constructor
实例过程中自动调用的方法，在方法内部通过<code>super</code>关键字获取来自父组件的<code>props</code></li> <li>getDerivedStateFromProps
新增的生命周期，是一个静态的方法，因此不能访问到组件的实例
<br>执行时机：组件创建和更新阶段，不论是<code>props</code>还是<code>state</code>变化，都会调用
<br>参数：（props，state），即将更新的<code>props</code>，上一个状态的<code>state</code></li> <li>render
类组件用于渲染<code>DOM</code>结构的方法，可以访问组件<code>state</code>和<code>props</code>属性</li> <li>componentDidMount
组件挂载到真实<code>DOM</code>后执行</li></ul> <h3 id="更新阶段"><a href="#更新阶段" class="header-anchor">#</a> 更新阶段</h3> <ul><li>getDerivedStateFromProps
同上</li> <li>shouldComponentUpdate
基于<code>props</code>和<code>state</code>是否需要重新渲染组件，默认返回<code>true</code></li> <li>render
同上</li> <li>getSnapshotBeforeUpdate
在<code>render</code>后执行，执行时<code>DOM</code>还没被更新
<br>参数<code>props</code>和<code>state</code>,返回的参数作为<code>componentDidUpdate</code>的第三参数，目的在于获取组件更新前的一些信息，如滚动位置之类，在组件更新后可以恢复一些UI上的状态</li> <li>componentDidUpdate
在组件更新结束后执行，可以根据前后的<code>props</code>和<code>state</code>的变化做相应的操作，如获取数据，修改<code>DOM</code>样式等</li></ul> <h3 id="卸载阶段"><a href="#卸载阶段" class="header-anchor">#</a> 卸载阶段</h3> <ul><li>componentWillUnmount
用于组件卸载前，清理一些注册监听事件，或者取消订阅的网络请求等。<br>一旦一个组件实例被卸载，其不会被再次挂载，而只可能是被重新创建</li></ul> <h3 id="与16-4-对比"><a href="#与16-4-对比" class="header-anchor">#</a> 与16.4-对比</h3> <p>减少了以下钩子，在现实使用中还能使用，只是增加了<code>UNDAFE_</code>前缀，原因是fiber架构，会导致render阶段会被多次执行，一下钩子可能会被多次执行</p> <ul><li>componentWillMount</li> <li>componentWillReceiveProps</li> <li>componentWillUpdate</li></ul> <h2 id="v18新特性"><a href="#v18新特性" class="header-anchor">#</a> v18新特性</h2> <h3 id="新增hook"><a href="#新增hook" class="header-anchor">#</a> 新增hook</h3> <ul><li>useId
解决了客户端和服务端id不同的问题
原理：利用组件在组件数中的层级生成id
用法：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">useId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;react&quot;</span> id<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>useTransition
在<code>React</code>中状态更新分为紧急更新和过渡更新：
<br>紧急更新：输出、点击、拖拽需要立即响应
<br>过渡更新：将UI从一个视图过渡到另一个视图
<br>使用<code>useTransition</code>可以将一个任务变为非紧急状态
用法：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span>startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token comment">// 紧急任务</span>
        <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token function">setSearch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token comment">// 非紧急任务</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>isPending <span class="token operator">&amp;&amp;</span> <span class="token string">'loading……'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token comment">/* 非紧急任务的状态 */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>useDeferredValue
将任务变成非紧急任务</li></ul> <div class="custom-block tip"><p class="custom-block-title">与useTrransition区别</p> <p>useDeferredValue把任务变成了<code>延迟更新任务</code>，useTransition则是把一个状态变成了<code>延迟状态</code></p></div> <p>用法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span>setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> deferedValue <span class="token operator">=</span> <span class="token function">useDeferrefValue</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token comment">// 紧急任务</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>List search<span class="token operator">=</span><span class="token punctuation">{</span>deferredValue<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token comment">/* 标记非紧急状态 */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/joe-leong/fe/edit/master/docs/frame/react16.md" target="_blank" rel="noopener noreferrer">为该章节纠错</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/10/18 07:28:08</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/fe/assets/js/app.3d2a803f.js" defer></script><script src="/fe/assets/js/2.17d60f83.js" defer></script><script src="/fe/assets/js/1.6a888610.js" defer></script><script src="/fe/assets/js/34.403d13b1.js" defer></script>
  </body>
</html>
