(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{321:function(t,s,a){"use strict";a.r(s);var e=a(14),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"react16"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react16"}},[t._v("#")]),t._v(" React16")]),t._v(" "),s("h2",{attrs:{id:"架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[t._v("#")]),t._v(" 架构")]),t._v(" "),s("p",[t._v("React16架构分为三层：")]),t._v(" "),s("ul",[s("li",[t._v("Scheduler（调度器）- 调度任务的优先级，高优先级优先进入"),s("code",[t._v("Reconciler")])]),t._v(" "),s("li",[t._v("Reconciler（协调器）- 负责找出变化的组件")]),t._v(" "),s("li",[t._v("Renderer（渲染器）- 负责将变化的组件渲染到页面上")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("相比较于15，增加了Scheduler调度任务")])]),t._v(" "),s("h3",{attrs:{id:"scheduler-调度器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scheduler-调度器"}},[t._v("#")]),t._v(" Scheduler（调度器）")]),t._v(" "),s("p",[t._v("如果需要实现异步，那么就需要知道浏览器是否有剩余时间，在浏览器中有原生的API"),s("code",[t._v("requestIdleCallback")]),t._v("，但是该api存在以下问题")]),t._v(" "),s("ul",[s("li",[t._v("兼容性")]),t._v(" "),s("li",[t._v("触发频率不稳定，影响因素很多。比如当前tab切换后，之前tab注册的时间触发的频率会变得很低。")])]),t._v(" "),s("p",[t._v("所以React实现了"),s("code",[t._v("requestIdleCallback")]),t._v("pollyfill。除了在空闲时触发回调的功能外，还提供了多种调度优先级供任务设置。")]),t._v(" "),s("h3",{attrs:{id:"reconciler-协调器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reconciler-协调器"}},[t._v("#")]),t._v(" Reconciler（协调器）")]),t._v(" "),s("p",[t._v("16+版本中，"),s("code",[t._v("Reconciler")]),t._v(" 更新工作从递归变成了可中断的循环过程。每次循环都会调用"),s("code",[t._v("shouldYield")]),t._v("获取当前是否有剩余时间。并且"),s("code",[t._v("Reconciler")]),t._v("和"),s("code",[t._v("Renderer")]),t._v("不再是交替工作。当"),s("code",[t._v("Schuduler")]),t._v("把任务交给"),s("code",[t._v("Reconciler")]),t._v("之后，"),s("code",[t._v("Reconciler")]),t._v("会为变化的虚拟DOM打上标记（增/删/更新）")]),t._v(" "),s("p",[t._v("整个过程都在内存中进行。只有当所有组件都完成"),s("code",[t._v("Reconciler")]),t._v("的工作，再会统一交给"),s("code",[t._v("Renderer")]),t._v("进行渲染工作")]),t._v(" "),s("p",[s("code",[t._v("Reconciler")]),t._v(" 和 "),s("code",[t._v("Schuduler")]),t._v(" 被称为 "),s("code",[t._v("render")]),t._v(" 阶段，具体流程如下：")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("beginwork")]),t._v(" 递")]),t._v(" "),s("ul",[s("li",[t._v("从 "),s("code",[t._v("rootFiber")]),t._v(" 开始 "),s("code",[t._v("child")]),t._v("，如果遇到函数组件或者类组件则调用渲染函数生成新的 "),s("code",[t._v("child")]),t._v("(Fiber Array)")]),t._v(" "),s("li",[s("code",[t._v("reconcilerChildren")]),t._v("，对已存在的child与生成的child进行diff，如果是单节点，直接进入更新单节点，如果是数组，则会进入diff逻辑，尽可能复用已有Fiber，创建的effectTag包含更新、删除并且更新 "),s("code",[t._v("父Fiber")]),t._v(" 的tag，如果是新建的话就不需要打tag\n"),s("code",[t._v("diff算法")]),t._v(":\n"),s("ul",[s("li",[s("code",[t._v("oldChild")]),t._v(" 与新渲染产生的child循序遍历，比较tag与key，如果相同则复用，判断props是否需要更新，需要更新则标记 "),s("code",[t._v("update")]),t._v(" 并更新父节点 "),s("code",[t._v("effectTag")]),t._v("，更新"),s("code",[t._v("lastPlaceIndex")])]),t._v(" "),s("li",[t._v("一旦遇到不能复用，则把"),s("code",[t._v("oldChild")]),t._v("创建map，遍历新节点，在map中查找可复用节点,如果没找到则新建 "),s("code",[t._v("Fiber")])]),t._v(" "),s("li",[t._v("遍历map，打上 "),s("code",[t._v("delete")]),t._v(" 标记")])])])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("completework")]),t._v(" 归")]),t._v(" "),s("ul",[s("li",[t._v("处理flag：把 "),s("code",[t._v("Fiber")]),t._v(" 自身的 "),s("code",[t._v("flag")]),t._v(" 以及 "),s("code",[t._v("subtreeFlag")]),t._v(" 冒泡到 "),s("code",[t._v("父Fiber")])]),t._v(" "),s("li",[t._v("处理 "),s("code",[t._v("Fiber")]),t._v(" 的 "),s("code",[t._v("stateNode")]),t._v("，如果没有则需要创建，并且把子孙节点append到当前DOM节点下，存在的话就更新props、事件绑定等")]),t._v(" "),s("li",[t._v("把每个 "),s("code",[t._v("Fiber")]),t._v(" 的 "),s("code",[t._v("Effect")]),t._v(" 添加到 "),s("code",[t._v("父Fiber")]),t._v(" 上组成 "),s("code",[t._v("effectList")]),t._v("，在commit阶段会遍历单向链执行对应操作")])])])]),t._v(" "),s("h3",{attrs:{id:"renderer-渲染器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#renderer-渲染器"}},[t._v("#")]),t._v(" Renderer（渲染器）")]),t._v(" "),s("p",[s("code",[t._v("Renderer")]),t._v("根据"),s("code",[t._v("Reconciler")]),t._v("的标记，同步执行对应的DOM操作\n此阶段也称为"),s("code",[t._v("commit 阶段")]),t._v("，分为三个步骤：")]),t._v(" "),s("h4",{attrs:{id:"before-mutation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#before-mutation"}},[t._v("#")]),t._v(" before mutation")]),t._v(" "),s("p",[t._v("遍历 "),s("code",[t._v("effectList")]),t._v(" 处理 "),s("code",[t._v("DOM")]),t._v(" 节点 "),s("code",[t._v("渲染/删除")]),t._v(" 后的 "),s("code",[t._v("聚焦/失焦")]),t._v(" 逻辑，调用 "),s("code",[t._v("getSnapShotBeforeUpdate")]),t._v(" 生命周期钩子，调度 "),s("code",[t._v("useEffect")]),t._v(" （使用SchedulerCallback调度）")]),t._v(" "),s("h4",{attrs:{id:"mutation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mutation"}},[t._v("#")]),t._v(" mutation")]),t._v(" "),s("ul",[s("li",[t._v("更新文本节点的content")]),t._v(" "),s("li",[t._v("更新ref")]),t._v(" "),s("li",[t._v("根据 "),s("code",[t._v("effectTag")]),t._v(" 进行对应处理，包含操作：移动、插入、更新、删除等组合")]),t._v(" "),s("li",[t._v("更新 "),s("code",[t._v("DOM")]),t._v(" props、properties（遍历pendingProps，数据在completeWork阶段完成处理）")]),t._v(" "),s("li",[t._v("如果是 "),s("code",[t._v("FC")]),t._v(" 则需要调用 "),s("code",[t._v("useLayout")]),t._v(" 的销毁函数")]),t._v(" "),s("li",[t._v("完成后再进入 "),s("code",[t._v("layout")]),t._v(" 阶段前需要把current指针切换，因为 "),s("code",[t._v("mutation")]),t._v(" 阶段会调用 "),s("code",[t._v("componentWillUnmount")]),t._v("，此时的 "),s("code",[t._v("DOM")]),t._v(" 还是更新前的")])]),t._v(" "),s("h4",{attrs:{id:"layout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#layout"}},[t._v("#")]),t._v(" layout")]),t._v(" "),s("p",[t._v("到达这个阶段，已经完成 "),s("code",[t._v("离屏DOM")]),t._v(" 的布局，只是浏览器尚未完成渲染")]),t._v(" "),s("ul",[s("li",[t._v("遍历 "),s("code",[t._v("effectList")]),t._v(" 执行 "),s("code",[t._v("commitLayoutEffcts")]),t._v(" 函数：赋值 "),s("code",[t._v("ref")]),t._v("、调用生命周期钩子和hooks")]),t._v(" "),s("li",[t._v("执行 "),s("code",[t._v("useLayout")]),t._v(" 回调函数，调度 "),s("code",[t._v("useEffect")]),t._v(" 的销毁函数以及回调函数")]),t._v(" "),s("li",[t._v("类组件 "),s("code",[t._v("this.setState")]),t._v(" 的第二个回调函数也会执行")]),t._v(" "),s("li",[t._v("执行的生命周期钩子："),s("code",[t._v("componentDidMount")]),t._v(", "),s("code",[t._v("componentDidUpdate")])])]),t._v(" "),s("h2",{attrs:{id:"生命周期-16-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生命周期-16-4"}},[t._v("#")]),t._v(" 生命周期（16.4+）")]),t._v(" "),s("h3",{attrs:{id:"创建阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建阶段"}},[t._v("#")]),t._v(" 创建阶段")]),t._v(" "),s("ul",[s("li",[t._v("constructor\n实例过程中自动调用的方法，在方法内部通过"),s("code",[t._v("super")]),t._v("关键字获取来自父组件的"),s("code",[t._v("props")])]),t._v(" "),s("li",[t._v("getDerivedStateFromProps\n新增的生命周期，是一个静态的方法，因此不能访问到组件的实例\n"),s("br"),t._v("执行时机：组件创建和更新阶段，不论是"),s("code",[t._v("props")]),t._v("还是"),s("code",[t._v("state")]),t._v("变化，都会调用\n"),s("br"),t._v("参数：（props，state），即将更新的"),s("code",[t._v("props")]),t._v("，上一个状态的"),s("code",[t._v("state")])]),t._v(" "),s("li",[t._v("render\n类组件用于渲染"),s("code",[t._v("DOM")]),t._v("结构的方法，可以访问组件"),s("code",[t._v("state")]),t._v("和"),s("code",[t._v("props")]),t._v("属性")]),t._v(" "),s("li",[t._v("componentDidMount\n组件挂载到真实"),s("code",[t._v("DOM")]),t._v("后执行")])]),t._v(" "),s("h3",{attrs:{id:"更新阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新阶段"}},[t._v("#")]),t._v(" 更新阶段")]),t._v(" "),s("ul",[s("li",[t._v("getDerivedStateFromProps\n同上")]),t._v(" "),s("li",[t._v("shouldComponentUpdate\n基于"),s("code",[t._v("props")]),t._v("和"),s("code",[t._v("state")]),t._v("是否需要重新渲染组件，默认返回"),s("code",[t._v("true")])]),t._v(" "),s("li",[t._v("render\n同上")]),t._v(" "),s("li",[t._v("getSnapshotBeforeUpdate\n在"),s("code",[t._v("render")]),t._v("后执行，执行时"),s("code",[t._v("DOM")]),t._v("还没被更新\n"),s("br"),t._v("参数"),s("code",[t._v("props")]),t._v("和"),s("code",[t._v("state")]),t._v(",返回的参数作为"),s("code",[t._v("componentDidUpdate")]),t._v("的第三参数，目的在于获取组件更新前的一些信息，如滚动位置之类，在组件更新后可以恢复一些UI上的状态")]),t._v(" "),s("li",[t._v("componentDidUpdate\n在组件更新结束后执行，可以根据前后的"),s("code",[t._v("props")]),t._v("和"),s("code",[t._v("state")]),t._v("的变化做相应的操作，如获取数据，修改"),s("code",[t._v("DOM")]),t._v("样式等")])]),t._v(" "),s("h3",{attrs:{id:"卸载阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#卸载阶段"}},[t._v("#")]),t._v(" 卸载阶段")]),t._v(" "),s("ul",[s("li",[t._v("componentWillUnmount\n用于组件卸载前，清理一些注册监听事件，或者取消订阅的网络请求等。"),s("br"),t._v("一旦一个组件实例被卸载，其不会被再次挂载，而只可能是被重新创建")])]),t._v(" "),s("h3",{attrs:{id:"与16-4-对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#与16-4-对比"}},[t._v("#")]),t._v(" 与16.4-对比")]),t._v(" "),s("p",[t._v("减少了以下钩子，在现实使用中还能使用，只是增加了"),s("code",[t._v("UNDAFE_")]),t._v("前缀，原因是fiber架构，会导致render阶段会被多次执行，一下钩子可能会被多次执行")]),t._v(" "),s("ul",[s("li",[t._v("componentWillMount")]),t._v(" "),s("li",[t._v("componentWillReceiveProps")]),t._v(" "),s("li",[t._v("componentWillUpdate")])]),t._v(" "),s("h2",{attrs:{id:"错误边界"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误边界"}},[t._v("#")]),t._v(" 错误边界")]),t._v(" "),s("p",[t._v("为了解决出现的错误导致整个应用崩溃的问题，"),s("code",[t._v("16")]),t._v("引入了"),s("code",[t._v("错误边界")]),t._v("的新概念。错误边界是一种"),s("code",[t._v("React")]),t._v("组件，这种组件可以捕获发生在其子组件树任何位置的"),s("code",[t._v("js")]),t._v("错误，并打印这些错误，同时展示降级"),s("code",[t._v("UI")]),t._v("，而不会渲染那些发生崩溃的子组件树。\n"),s("br"),t._v("形成错误边界的两个条件,")]),t._v(" "),s("ul",[s("li",[t._v("使用了static getDerivedStataFromError,在错误抛出后，渲染备用"),s("code",[t._v("UI")])]),t._v(" "),s("li",[t._v("使用了componentDidCatch打印错误信息")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ErrorBoundary")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hasError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDerivedStateFromError")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hasError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidCatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("errorInfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以将错误日志上报服务器")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hasError "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("somthing wrong"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("h1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如果不是渲染阶段产生的错误，并不会被错误边界捕获。需要在组件内监听，或者在全局监听。")]),t._v(" "),s("ul",[s("li",[t._v("使用trycatch语法捕获在组件内操作"),s("code",[t._v("UI")]),t._v("降级")]),t._v(" "),s("li",[t._v("在全局监听error事件，window.addEventListener('error',function(e){})")])]),t._v(" "),s("h2",{attrs:{id:"v18新特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v18新特性"}},[t._v("#")]),t._v(" v18新特性")]),t._v(" "),s("h3",{attrs:{id:"新增hook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新增hook"}},[t._v("#")]),t._v(" 新增hook")]),t._v(" "),s("ul",[s("li",[t._v("useId\n解决了客户端和服务端id不同的问题\n原理：利用组件在组件数中的层级生成id\n用法：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"checkbox"')]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"react"')]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("useTransition\n在"),s("code",[t._v("React")]),t._v("中状态更新分为紧急更新和过渡更新：\n"),s("br"),t._v("紧急更新：输出、点击、拖拽需要立即响应\n"),s("br"),t._v("过渡更新：将UI从一个视图过渡到另一个视图\n"),s("br"),t._v("使用"),s("code",[t._v("useTransition")]),t._v("可以将一个任务变为非紧急状态\n用法：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("isPending"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("startTransition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useTransition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" onChange"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 紧急任务")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("startTransition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSearch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 非紧急任务")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("isPending "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loading……'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 非紧急任务的状态 */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("useDeferredValue\n将任务变成非紧急任务")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("与useTrransition区别")]),t._v(" "),s("p",[t._v("useDeferredValue把任务变成了"),s("code",[t._v("延迟更新任务")]),t._v("，useTransition则是把一个状态变成了"),s("code",[t._v("延迟状态")])])]),t._v(" "),s("p",[t._v("用法：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("setState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" deferedValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useDeferrefValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" onChange"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 紧急任务")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("List search"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("deferredValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 标记非紧急状态 */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);