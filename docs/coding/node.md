---
title: ç®—æ³• ä¸“é¢˜
categories:
  - è®¡ç®—æœºåŸºç¡€
  - ç®—æ³•
  - node
tags:
  - ç¼–ç 
  - å‰ç«¯
author:
  name: joe
  link: https://github.com/joe-leong/fe
---

# Node

# [ä¸¤ä¸ªNodeè¿›ç¨‹å¦‚ä½•é€šä¿¡](https://juejin.cn/post/7016233869565231135)

- ä¸åŒç”µè„‘ä¸Šçš„ä¸¤ä¸ªNodeè¿›ç¨‹é€šä¿¡
é€šå¸¸ä½¿ç”¨ `TCP` æˆ–è€… `HTTP` è¿›è¡Œé€šä¿¡
<br>
- åŒä¸€å°ç”µè„‘ä¸Šä¸¤ä¸ªNodeè¿›ç¨‹é€šä¿¡
  - è¿›ç¨‹ä¸è‡ªå·±åˆ›å»ºçš„å­è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„IPCé€šä¿¡
  - è¿›ç¨‹ä¸åˆ«çš„ä¸ç›¸å…³çš„è¿›ç¨‹é€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç®¡é“

# Node ä¸æµè§ˆå™¨ EventLoop çš„åŒºåˆ«

- æµè§ˆå™¨äº‹ä»¶å¾ªç¯æœ‰ä¸¤ä¸ªé»˜è®¤äº‹ä»¶é˜Ÿåˆ—
  - å®ä»»åŠ¡é˜Ÿåˆ—
  - å¾®ä»»åŠ¡é˜Ÿåˆ—
- Node æ ¹æ®ä»»åŠ¡çš„ç§ç±»å’Œä¼˜å…ˆçº§ï¼Œåˆ†æˆäº† 6 ä¸ªé˜¶æ®µæ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡
  - å®šæ—¶å™¨ï¼ˆtimersï¼‰ï¼šè¯¥é˜¶æ®µç”¨äºåˆ¤æ–­æ˜¯å¦æ‰§è¡Œå®šæ—¶å™¨å›è°ƒ
  - å¾…å®šå›è°ƒï¼ˆpending callbacksï¼‰ï¼šç”¨äºæ‰§è¡Œç½‘ç»œI/O ç­‰å¼‚å¸¸æ—¶çš„å›è°ƒï¼›æ‰§è¡Œä¸Šä¸€è½®æ®‹ç•™çš„å›è°ƒ
  - idleï¼Œprepareï¼šä»…ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨
  - è½®è¯¢ï¼ˆpollï¼‰ï¼šè¯¥é˜¶æ®µç”¨äºæ‰§è¡Œ æ‰€æœ‰å…¶ä»–é˜¶æ®µä¸å¤„ç†çš„ I/Oå›è°ƒ + æ£€ç´¢æ–°çš„I/Oäº‹ä»¶
    - ç”Ÿæˆè¯¥é˜¶æ®µé¢„è®¾é˜»å¡çš„æ—¶é—´ + é¢„è®¾è½®è¯¢I/O çš„æ—¶é—´
    - æ‰§è¡Œå¤§å¤šæ•°çš„ç½‘ç»œI/Oï¼Œæ–‡ä»¶I/O
    - å¦‚æœè½®è¯¢é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œéå†é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œå›è°ƒï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©º
    - å¦‚æœä¸ºç©º
      - å¦‚æœæœ‰ setimmediate å›è°ƒéœ€è¦æ‰§è¡Œï¼Œç«‹å³ç»“æŸ poll é˜¶æ®µï¼Œå¹¶è¿›å…¥ check é˜¶æ®µ
      - å¦‚æœæ²¡æœ‰ setimmediate å›è°ƒéœ€è¦æ‰§è¡Œï¼Œåˆ™åœç•™åœ¨è¯¥é˜¶æ®µä»¥ç­‰å¾…å›è°ƒè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œç„¶åç«‹å³æ‰§è¡Œã€‚åœ¨è¶…æ—¶æ—¶é—´åˆ°è¾¾å‰ï¼Œäº‹ä»¶å¾ªç¯ä¼šä¸€ç›´åœç•™ç­‰å¾…
  - æ£€æµ‹ï¼ˆcheckï¼‰ï¼šsetimmediate å›è°ƒå‡½æ•°åœ¨è¿™é‡Œæ‰§è¡Œ
  - å…³é—­çš„å›è°ƒå‡½æ•°ï¼ˆclose callbacksï¼‰ï¼šç”¨äºæ‰§è¡Œä¸€äº›å…³é—­èµ„æºçš„å›è°ƒï¼Œä¼˜å…ˆçº§æœ€ä½

```txt
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€>â”‚           timers          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     pending callbacks     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚       idle, prepare       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   incoming:   â”‚
â”‚  â”‚           poll            â”‚<â”€â”€â”€â”€â”€â”¤  connections, â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   data, etc.  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚           check           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”¤      close callbacks      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

:::tip
node11 ä¹‹åï¼Œå¾®ä»»åŠ¡çš„è°ƒåº¦ä¼šç©¿æ’åœ¨æ¯ä¸€ä¸ªtimersä»»åŠ¡æ‰§è¡Œä¹‹ä¸­ï¼š
timersæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ -> æ¸…ç©ºprocess.nextTick() + promise.then() ä»»åŠ¡é˜Ÿåˆ— -> timersæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ ä¾æ¬¡å¾ªç¯ï¼Œç›´åˆ°å…¨éƒ¨æ‰§è¡Œå®Œæˆ
:::

ğŸš§
